{extend name='public/_container'} {block name="content"}
<div class="row">
    <div class="col-sm-12">
        <div class="ibox float-e-margins">

            <div class="ibox-content" style="margin-top:20px;">
                <div id="frmt" class="demo"></div>
            </div>

            <div class="row btn-group-m-t">
                <div class="col-sm-9">
                    <button type="button" class="btn btn-primary" onclick="getMenuIds()" id="ensure">
                        <i class="fa fa-check"></i>&nbsp;确认提交
                    </button>
                    <button type="button" class="btn btn-danger" onclick="InfoDlg.close()" id="cancel" style="margin-left: 20px">
                        <i class="fa fa-remove"></i>&nbsp;取消关闭
                    </button>
                </div>
            </div>
        </div>
    </div>

</div>

<link rel="stylesheet" href="__ADMIN__/css/plugins/jsTree/style.min.css"/>
<script src="__ADMIN__/js/plugins/jsTree/jstree.js"></script>
<script>

    // 全选
    $('#check-all').click(function () {
        $('#frmt').jstree(true).check_all();
    });
    // 取消全选
    $('#uncheck-all').click(function () {
        $('#frmt').jstree(true).uncheck_all();
    });
    // 展开所有
    $('#expand-all').click(function () {
        $('#frmt').jstree(true).open_all();
    });
    // 收起所有
    $('#collapse-all').click(function () {
        $('#frmt').jstree(true).close_all();
    });


    $('#frmt').jstree({
        plugins: ["checkbox", "search"],
        "checkbox": {
            "keep_selected_style": false,//是否默认选中
            "three_state": false,//父子级别级联选择
            "cascade": 'down+up',
        },
        'core': {
            'data': {:htmlspecialchars_decode($nodes)}
        }
    });

    var InfoDlg = {
        formData: {},
    }

    function getMenuIds() {
        var idx = [];
        var jstree = $(".jstree-clicked").each(function () {
            idx.push($(this).attr('data-id'));
        });

        var ajax = new $ax("{:url('auth')}", function (data) {
            if (data.status === 200) {
                com.success(data.msg, 1000);
                window.parent.TableList.table.refresh();
                InfoDlg.close();
            } else {
                com.error(data.msg + "！", 1000);
            }
        });
        ajax.set('idx', idx);
        ajax.set('id', "{$id}");
        ajax.set(this.CodeInfoData);
        ajax.start();
    }
</script>
<script src="__ADMIN__/js/common/formCom.js" charset="utf-8"></script>
{/block}


